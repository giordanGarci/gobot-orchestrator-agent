package templates

templ DeployForm() {
	<div class="max-w-md bg-gray-800 p-6 rounded-lg shadow-lg mx-auto mt-10">
		<h2 class="text-lg mb-4 font-semibold">Iniciar RobÃ´</h2>
		
		<form id="deploy-form" class="space-y-4">
			<div>
				<label class="block text-sm text-gray-400">Bot ID</label>
				<input name="bot_id" type="text" class="w-full bg-gray-700 border-none rounded p-2 mt-1" placeholder="ex: rpa-01"/>
			</div>
			
			<div>
				<label class="block text-sm text-gray-400">Git Repo</label>
				<input name="git_repo" type="text" class="w-full bg-gray-700 border-none rounded p-2 mt-1" placeholder="https://github.com/..."/>
			</div>

			<div>
				<label class="block text-sm text-gray-400">VersÃ£o</label>
				<input name="version" type="text" class="w-full bg-gray-700 border-none rounded p-2 mt-1" placeholder="1.0.0"/>
			</div>

			<button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 py-2 rounded font-bold transition">
				rodar o bot ðŸš€
			</button>
		</form>
		<div id="log-container" class="mt-6 p-4 bg-black rounded text-green-500 font-mono text-sm h-64 overflow-y-auto">
			Aguardando comando...
		</div>
	</div>

	<script>
		document.getElementById('deploy-form').addEventListener('submit', async (e) => {
			e.preventDefault();
			
			const form = e.target;
			const logContainer = document.getElementById('log-container');
			logContainer.innerHTML = '<div class="text-yellow-400">Iniciando...</div>';
			
			const data = {
				bot_id: form.bot_id.value,
				git_repo: form.git_repo.value,
				version: form.version.value
			};

			try {
				const response = await fetch('/bots/run', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(data)
				});

				const reader = response.body.getReader();
				const decoder = new TextDecoder();

				while (true) {
					const { done, value } = await reader.read();
					if (done) break;
					
					const text = decoder.decode(value, { stream: true });
					logContainer.innerHTML += text;
					logContainer.scrollTop = logContainer.scrollHeight;
				}
			} catch (err) {
				logContainer.innerHTML += `<div class="text-red-400">[ERROR] ${err.message}</div>`;
			}
		});
	</script>
}